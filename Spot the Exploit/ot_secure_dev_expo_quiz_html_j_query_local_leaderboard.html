<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spot the Exploit ‚Äî OT & Secure Dev Quiz</title>
  <!-- jQuery CDN (required). If your expo is offline, download jquery-3.7.1.min.js and replace the src below with a local file path. -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <style>
    :root{
      --bg0:#07070a; --bg1:#0d1021; --bg2:#121635; --card:#0c1026aa; --accent:#7cfcff; --accent2:#7cf7c1; --warn:#ff6b6b; --ok:#7dfc7d; --text:#eaf2ff; --muted:#9db0d4;
      --glass: rgba(255,255,255,0.06); --glass-brd: rgba(255,255,255,0.15);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:"Inter", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background: radial-gradient(1200px 800px at 80% -10%, #1f2a68 0%, transparent 55%),
                  radial-gradient(900px 600px at 10% 110%, #0b5b5b 0%, transparent 60%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100svh; display:flex; align-items:center; justify-content:center; padding:24px;
      overflow-x:hidden;
    }
    .container{ width:min(1100px, 100%); }
    .glass{
      background:var(--glass); border:1px solid var(--glass-brd); border-radius:24px; backdrop-filter: blur(10px);
      box-shadow: 0 20px 60px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.05);
    }
    header{
      padding:20px 28px; display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{ width:44px; height:44px; border-radius:12px; background:conic-gradient(from 220deg, var(--accent), #6f8cff, #7cfcff); box-shadow:0 0 24px rgba(124,252,255,.45); }
    h1{ margin:0; font-size: clamp(20px, 2.2vw, 28px); letter-spacing:.2px; }
    .tag{ color:var(--muted); font-size:14px; }

    .main{ display:grid; grid-template-columns: 1fr; gap:18px; }

    .screen{ display:none; padding:24px; }
    .screen.active{ display:block; animation: pop .5s ease; }
    @keyframes pop{ from{ opacity:0; transform: translateY(10px) scale(.98);} to{ opacity:1; transform:none; } }

    .card{ padding:20px; border-radius:18px; }

    /* Hero */
    .hero{ display:grid; grid-template-columns: 1.2fr .8fr; gap:20px; }
    @media (max-width:900px){ .hero{ grid-template-columns: 1fr; } }

    .cta{ padding:28px; }
    .cta h2{ margin:0 0 8px 0; font-size: clamp(22px, 2.4vw, 32px); }
    .cta p{ margin:0; color:var(--muted); }

    .enroll{ display:flex; gap:12px; margin-top:16px; }
    input[type="text"]{
      width:100%; padding:14px 16px; border-radius:12px; border:1px solid var(--glass-brd); background:#0a0f25; color:var(--text);
      outline:none; font-size:16px; transition:.2s border-color;
    }
    input[type="text"]:focus{ border-color:var(--accent); box-shadow:0 0 0 4px rgba(124,252,255,.12); }

    .btn{
      --btn-bg: linear-gradient(135deg, #2ad0d0, #7cfcff 55%, #8ef7c8);
      padding:12px 18px; border-radius:12px; border:0; color:#091119; font-weight:700; letter-spacing:.3px; cursor:pointer; transition: transform .06s ease; 
      background: var(--btn-bg); box-shadow: 0 10px 30px rgba(124,252,255,.35), inset 0 0 0 1px rgba(255,255,255,.35);
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn.secondary{ background:transparent; color:var(--text); border:1px solid var(--glass-brd); box-shadow:none; }

    .pill{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--glass-brd); background:#0b112c99; color:var(--muted); font-size:13px;
    }

    .grid-2{ display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
    @media (max-width:900px){ .grid-2{ grid-template-columns:1fr; } }

    /* Game card */
    .question-card{ position:relative; overflow:hidden; }
    .statusbar{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
    .statusbar .pill{ font-weight:600; }
    .progress{ position:relative; height:8px; border-radius:999px; background:#0a0f28; overflow:hidden; border:1px solid var(--glass-brd); }
    .progress>span{ position:absolute; inset:0; width:0%; background:linear-gradient(90deg, #7cfcff, #8ef7c8); box-shadow: 0 8px 20px rgba(124,252,255,.35); }

    pre.snippet{
      background:#070a1e; border:1px dashed #1b2a52; color:#cde3ff; padding:18px; border-radius:14px; font-size:14px; line-height:1.5; overflow:auto; max-height:280px;
    }

    .actions{ display:flex; gap:12px; }
    .choice{ flex:1; padding:16px 18px; border-radius:14px; border:1px solid var(--glass-brd); background:#0a0f25; color:var(--text); font-weight:800; letter-spacing:.6px; cursor:pointer; transition:.18s;
      text-transform:uppercase;
    }
    .choice:hover{ transform: translateY(-1px); box-shadow:0 8px 20px rgba(0,0,0,.25); }
    .choice.secure{ border-color:#2bb67355; }
    .choice.vuln{ border-color:#ff6b6b55; }

    .reveal{ margin-top:12px; display:none; }
    .reveal.good{ color:var(--ok); }
    .reveal.bad{ color:var(--warn); }

    /* Leaderboard */
    .table{ width:100%; border-collapse:separate; border-spacing:0 10px; }
    .table th{ color:var(--muted); font-weight:600; text-align:left; padding:0 10px; font-size:14px; }
    .table td{ background:#0a0f25; border:1px solid var(--glass-brd); padding:14px 12px; }
    .table tr td:first-child{ border-radius:12px 0 0 12px; }
    .table tr td:last-child{ border-radius:0 12px 12px 0; }

    .footer{ color:var(--muted); font-size:12px; text-align:center; margin-top:8px; }

    /* Floating particles */
    .particles{ position:fixed; inset:0; pointer-events:none; z-index:-1; }
    .dot{ position:absolute; width:6px; height:6px; border-radius:50%; background:radial-gradient(circle at 30% 30%, #ffffff, #7cfcff 40%, transparent 70%); opacity:.15; }
  </style>
</head>
<body>
  <div class="particles" aria-hidden="true"></div>
  <div class="container glass">
    <header>
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>Spot the Exploit ‚Äî OT & Secure Dev</h1>
          <div class="tag">Cybersecurity Expo Edition ‚Ä¢ jQuery-powered ‚Ä¢ Local leaderboard</div>
        </div>
      </div>
      <button class="btn secondary" id="showLeaderboardBtn">Leaderboard</button>
    </header>

    <main class="main">
      <!-- START SCREEN -->
      <section id="start" class="screen active">
        <div class="hero">
          <div class="cta glass card">
            <h2>Can you tell <em>Secure</em> from <em>Vulnerable</em> ‚Äî under pressure?</h2>
            <p>Classify each OT / embedded / secure dev snippet. 10 rounds. +1 for right, -1 for wrong. You get immediate feedback and see why. Aim for the leaderboard!</p>
            <div class="enroll">
              <input id="playerName" type="text" placeholder="Enter player name (for leaderboard)" maxlength="24" />
              <button class="btn" id="startBtn">Start</button>
            </div>
            <div class="footer">Tip: Short on time? You can restart anytime. Scores persist on this device.</div>
          </div>
          <div class="glass card">
            <div class="grid-2">
              <div class="pill">‚è± 90s max</div>
              <div class="pill">üèÜ Top 10 saved</div>
              <div class="pill">üß† Explanations</div>
              <div class="pill">üñ± Touch-friendly</div>
            </div>
            <div style="height:14px"></div>
            <div class="progress"><span id="demoProgress" style="width:35%"></span></div>
            <div style="height:10px"></div>
            <p class="tag">This is a demo progress bar ‚Äî your in-game timer will tick down in real time.</p>
          </div>
        </div>
      </section>

      <!-- GAME SCREEN -->
      <section id="game" class="screen">
        <div class="glass card question-card">
          <div class="statusbar">
            <div class="pill">Player: <span id="uiPlayer">‚Äî</span></div>
            <div class="pill">Score: <span id="uiScore">0</span></div>
            <div class="pill">Q: <span id="uiIdx">1</span>/<span id="uiTotal">10</span></div>
            <div class="pill">Time: <span id="uiTime">90</span>s</div>
          </div>
          <div class="progress" aria-hidden="true"><span id="timeBar"></span></div>
          <h2 id="qTitle" style="margin:12px 0 8px 0">‚Äî</h2>
          <pre class="snippet" id="qSnippet"></pre>
          <div class="actions" style="margin-top:12px">
            <button class="choice vuln" data-ans="vulnerable">üö® Vulnerable</button>
            <button class="choice secure" data-ans="secure">üõ°Ô∏è Secure</button>
          </div>
          <div class="reveal" id="reveal"></div>
        </div>
      </section>

      <!-- END SCREEN -->
      <section id="end" class="screen">
        <div class="glass card">
          <h2 style="margin:0 0 10px 0">GG, <span id="finalPlayer">Player</span>!</h2>
          <p class="tag">Your score: <strong id="finalScore">0</strong>. See where you stand on the leaderboard üëá</p>
          <div style="height:10px"></div>
          <div class="actions">
            <button class="btn" id="playAgain">Play Again</button>
            <button class="btn secondary" id="viewLB">View Leaderboard</button>
          </div>
        </div>

        <div class="glass card" id="leaderboardCard">
          <h3 style="margin:0 0 8px 0">üèÜ Leaderboard (Top 10 on this device)</h3>
          <table class="table" id="leaderboardTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Score</th>
                <th>When</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="actions" style="margin-top:10px">
            <button class="btn secondary" id="resetLB">Reset Leaderboard</button>
          </div>
          <div class="footer">Storage: Browser localStorage only (per device).</div>
        </div>
      </section>

      <!-- LEADERBOARD MODAL (quick access) -->
      <section id="leaderboardModal" class="screen">
        <div class="glass card">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
            <h3 style="margin:0">üèÜ Leaderboard</h3>
            <button class="btn secondary" id="closeLB">Close</button>
          </div>
          <table class="table" id="leaderboardTable2">
            <thead>
              <tr><th>#</th><th>Name</th><th>Score</th><th>When</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <audio id="sndCorrect" preload="auto">
    <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQAA" type="audio/mpeg" />
  </audio>
  <audio id="sndWrong" preload="auto">
    <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQAA" type="audio/mpeg" />
  </audio>

  <script>
    // ---- Demo particles for ambience ----
    function spawnParticles(){
      const $p = $(".particles");
      for(let i=0;i<40;i++){
        const $d = $('<div class="dot"/>').css({
          left: Math.random()*100+'%', top: Math.random()*100+'%',
          transform: `scale(${0.4+Math.random()*1.2})`
        });
        $p.append($d);
      }
      animateDots();
    }
    function animateDots(){
      $(".dot").each(function(){
        const dx = (Math.random()*2-1)*30; // px
        const dy = (Math.random()*2-1)*30;
        const d = 5000+Math.random()*7000;
        $(this).animate({ left: `+=${dx}`, top: `+=${dy}`, opacity: 0.1+Math.random()*0.3 }, d, 'swing', animateDots);
      });
    }

    // ---- Quiz content ----
    const QUESTIONS = [
      {
        title: "Default creds + exposed Modbus",
        snippet: "PLC login: admin/admin\nInternet exposure: TCP/502 (Modbus) open on WAN\nGeo IP: Public cloud VM",
        answer: "vulnerable",
        why: "Default credentials and publicly exposed Modbus TCP allow trivial remote control; must segment (ISA/IEC 62443), disable WAN exposure, enforce unique creds/VPN."
      },
      {
        title: "Signed firmware + anti-rollback",
        snippet: "update_method: signed_firmware\nsignature_verification: enabled\nrollback_prevention: true",
        answer: "secure",
        why: "Signature verification and rollback prevention protect against tampered and downgrade attacks‚Äîbest practice for OTA in OT/ICS."
      },
      {
        title: "C buffer without bounds",
        snippet: "char buf[10];\nstrcpy(buf, input);",
        answer: "vulnerable",
        why: "strcpy() has no length check ‚Üí buffer overflow ‚Üí RCE or crash. Use strncpy/strlcpy + length checks and safe parsing."
      },
      {
        title: "MQTT over TLS with pinned CA",
        snippet: "mqtt:\n  host: iot.example.com:8883\n  tls: required\n  ca_pinning: true",
        answer: "secure",
        why: "TLS + CA pinning mitigates MITM on broker connections; ensure cipher hardening and cert rotation process."
      },
      {
        title: "Unauthenticated firmware endpoint",
        snippet: "POST /api/firmware/upload\nAuthorization: (none)\n\n(binary payload)",
        answer: "vulnerable",
        why: "Unsigned/unauthenticated firmware upload allows arbitrary code. Require admin auth + signature validation + audit."
      },
      {
        title: "CAN ID filtering + auth flag",
        snippet: "if (msg.id == 0x123 && msg.authenticated) {\n  process(msg);\n}",
        answer: "secure",
        why: "ID filtering + authenticity gating limits spoofing. Combine with rate limiting and gateway segmentation."
      },
      {
        title: "Hardcoded SAS token in firmware",
        snippet: "const char* SAS = \"SharedAccessSignature sr=iot&sig=...&se=9999999999\";",
        answer: "vulnerable",
        why: "Embedded long-lived secrets enable device impersonation. Use per-device short-lived tokens, secure element/TPM, rotation."
      },
      {
        title: "CSP + WAF note (XSS)",
        snippet: "Content-Security-Policy: default-src 'self'\nWAF: enabled\nStorage: HttpOnly cookies for session",
        answer: "secure",
        why: "Strict CSP and HttpOnly cookies reduce XSS session theft; WAF adds layered defense. Avoid localStorage for tokens."
      },
      {
        title: "Unsigned bootloader accepts downgrades",
        snippet: "bootloader: allow_downgrade: true\nsignature_check: disabled",
        answer: "vulnerable",
        why: "Attackers can flash older vulnerable images. Enforce secure boot + anti-rollback."
      },
      {
        title: "Least-privileged service account",
        snippet: "service: hvac-ctl\nrun_as: user:hvac_svc\ncapabilities: NET_BIND_SERVICE\nseccomp: enforced",
        answer: "secure",
        why: "Drops root, grants minimal capabilities, and enables seccomp‚Äîgood hardening for OT edge services."
      }
    ];

    // ---- State ----
    let state = { idx: 0, score: 0, time: 90, name: "Player" };
    const TOTAL = QUESTIONS.length;

    // ---- Local Storage Leaderboard ----
    const LB_KEY = 'otx_leaderboard_v1';
    function loadLB(){
      try{ return JSON.parse(localStorage.getItem(LB_KEY)) || []; }catch(e){ return []; }
    }
    function saveLB(arr){ localStorage.setItem(LB_KEY, JSON.stringify(arr)); }
    function addScore(name, score){
      const lb = loadLB();
      lb.push({ name: name||'Player', score, ts: Date.now() });
      lb.sort((a,b)=> b.score - a.score || a.ts - b.ts);
      const top = lb.slice(0,10);
      saveLB(top);
      return top;
    }
    function fmtWhen(ts){
      try{
        const d = new Date(ts);
        return d.toLocaleString();
      }catch(e){ return '‚Äî'; }
    }
    function renderLB($tbody, data){
      $tbody.empty();
      if(!data.length){
        $tbody.append('<tr><td colspan="4" class="tag" style="padding:18px">No scores yet ‚Äî be the first! üéØ</td></tr>');
        return;
      }
      data.forEach((row,i)=>{
        $tbody.append(`<tr>
          <td>${i+1}</td>
          <td>${$('<div/>').text(row.name).html()}</td>
          <td><strong>${row.score}</strong></td>
          <td class="tag">${fmtWhen(row.ts)}</td>
        </tr>`);
      });
    }

    // ---- Game Flow ----
    let timerHandle = null;
    function show(screenId){
      $('.screen').removeClass('active').hide();
      const $s = $('#'+screenId).show().addClass('active');
      $('html,body').stop(true).animate({scrollTop:0}, 300);
      return $s;
    }

    function startGame(){
      state.idx = 0; state.score = 0; state.time = 90;
      $('#uiPlayer').text(state.name);
      $('#uiScore').text(state.score);
      $('#uiIdx').text(1);
      $('#uiTotal').text(TOTAL);
      $('#reveal').hide();
      show('game');
      nextQuestion();
      startTimer();
    }

    function startTimer(){
      clearInterval(timerHandle);
      const $bar = $('#timeBar');
      const total = state.time; // start at 90
      let t = total;
      $('#uiTime').text(t);
      $bar.css({width:'0%'});
      timerHandle = setInterval(()=>{
        t--; state.time = t; $('#uiTime').text(t);
        const pct = (1 - (t/total))*100;
        $bar.css('width', pct+'%');
        if(t<=0){ clearInterval(timerHandle); endGame(); }
      }, 1000);
    }

    function nextQuestion(){
      const q = QUESTIONS[state.idx];
      if(!q){ return endGame(); }
      $('#qTitle').text(q.title);
      $('#qSnippet').text(q.snippet);
      $('#reveal').hide().removeClass('good bad').text('');
      $('.choice').prop('disabled', false);
      $('#uiIdx').text(state.idx+1);
      // subtle intro animation
      $('#qSnippet').css({opacity:0, transform:'translateY(6px)'}).animate({opacity:1, translateY:0}, 220);
    }

    function answer(choice){
      const q = QUESTIONS[state.idx];
      if(!q) return;
      const correct = (choice === q.answer);
      state.score += correct ? 1 : -1;
      $('#uiScore').text(state.score);
      const $rev = $('#reveal');
      $rev.stop(true,true).hide()
          .toggleClass('good', correct)
          .toggleClass('bad', !correct)
          .text((correct? '‚úî Correct ‚Äî ' : '‚úñ Incorrect ‚Äî ') + q.why)
          .fadeIn(180);
      $('#snd' + (correct? 'Correct':'Wrong'))[0].play().catch(()=>{});
      $('.choice').prop('disabled', true);
      // slide to next
      setTimeout(()=>{
        $('#qSnippet').animate({opacity:0}, 150, ()=>{
          state.idx++;
          nextQuestion();
        });
      }, 900);
    }

    function endGame(){
      clearInterval(timerHandle);
      const lb = addScore(state.name, state.score);
      $('#finalPlayer').text(state.name);
      $('#finalScore').text(state.score);
      renderLB($('#leaderboardTable tbody'), lb);
      show('end');
    }

    // ---- Wire UI ----
    $(function(){
      spawnParticles();

      // Demo progress shimmer on start screen
      $('#demoProgress').animate({ width:'100%' }, 5000).animate({ width:'35%' }, 600);

      $('#startBtn').on('click', function(){
        const n = $('#playerName').val().trim();
        state.name = n || 'Player';
        startGame();
      });

      $('.choice').on('click', function(){
        answer($(this).data('ans'));
      });

      $('#playAgain').on('click', function(){ show('start'); });
      $('#viewLB').on('click', function(){ show('end'); });

      $('#resetLB').on('click', function(){ saveLB([]); renderLB($('#leaderboardTable tbody'), []); });

      $('#showLeaderboardBtn').on('click', function(){
        const lb = loadLB();
        renderLB($('#leaderboardTable2 tbody'), lb);
        show('leaderboardModal');
      });
      $('#closeLB').on('click', function(){ show('start'); });
    });
  </script>
</body>
</html>
